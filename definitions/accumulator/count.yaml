# $schema: ../../schemas/operator.json
name: $count
link: https://www.mongodb.com/docs/manual/reference/operator/aggregation/count-accumulator/
minVersion: '5.0'
type:
  - accumulator
  - window
encode: object
description: |
  Returns the number of documents in the group or window.
  Distinct from the $count pipeline stage.
tests:
  - name: Use in $group Stage
    link: https://www.mongodb.com/docs/manual/reference/operator/aggregation/count-accumulator/#use-in--group-stage
    pipeline:
      - $group:
          _id: $state
          countNumberOfDocumentsForState:
            $count: {}
    schema:
      cakeSales:
        _id:
          types:
            - bsonType: Number
        type:
          types:
            - bsonType: String
        orderDate:
          types:
            - bsonType: Date
        state:
          types:
            - bsonType: String
        price:
          types:
            - bsonType: Number
        quantity:
          types:
            - bsonType: Number
  - name: Use in $setWindowFields Stage
    link: https://www.mongodb.com/docs/manual/reference/operator/aggregation/count-accumulator/#use-in--setwindowfields-stage
    pipeline:
      - $setWindowFields:
          partitionBy: $state
          sortBy:
            orderDate: 1
          output:
            countNumberOfDocumentsForState:
              $count: {}
              window:
                documents:
                  - unbounded
                  - current
    schema:
      cakeSales:
        _id:
          types:
            - bsonType: Number
        type:
          types:
            - bsonType: String
        orderDate:
          types:
            - bsonType: Date
        state:
          types:
            - bsonType: String
        price:
          types:
            - bsonType: Number
        quantity:
          types:
            - bsonType: Number
