# $schema: ../../schema.json
name: $avg
link: https://www.mongodb.com/docs/manual/reference/operator/aggregation/avg/
minVersion: '3.2'
type:
  - resolvesToNumber
encode: single
description: |
  Returns an average of numerical values. Ignores non-numeric values.
  Changed in MongoDB 5.0: Available in the $setWindowFields stage.
arguments:
  - name: expression
    type:
      - resolvesToNumber
    variadic: array
tests:
  - name: Use in $project Stage
    link: https://www.mongodb.com/docs/manual/reference/operator/aggregation/avg/#use-in--project-stage
    pipeline:
      - $project:
          quizAvg:
            $avg: $quizzes
          labAvg:
            $avg: $labs
          examAvg:
            $avg:
              - $final
              - $midterm
    schema:
      TestCollection:
        _id:
          types:
            - bsonType: Number
        quizzes:
          types:
            - bsonType: Array
              types:
                - bsonType: Number
        labs:
          types:
            - bsonType: Array
              types:
                - bsonType: Number
        final:
          types:
            - bsonType: Number
        midterm:
          types:
            - bsonType: Number
